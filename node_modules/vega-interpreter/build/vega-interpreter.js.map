{"version":3,"file":"vega-interpreter.js","sources":["../src/adjust-spatial.js","../src/constants.js","../src/ops-binary.js","../src/ops-unary.js","../src/functions.js","../src/interpret.js","../src/expression.js"],"sourcesContent":["export default function(item, encode, swap) {\n  let t;\n\n  if (encode.x2) {\n    if (encode.x) {\n      if (swap && item.x > item.x2) {\n        t = item.x;\n        item.x = item.x2;\n        item.x2 = t;\n      }\n      item.width = item.x2 - item.x;\n    } else {\n      item.x = item.x2 - (item.width || 0);\n    }\n  }\n\n  if (encode.xc) {\n    item.x = item.xc - (item.width || 0) / 2;\n  }\n\n  if (encode.y2) {\n    if (encode.y) {\n      if (swap && item.y > item.y2) {\n        t = item.y;\n        item.y = item.y2;\n        item.y2 = t;\n      }\n      item.height = item.y2 - item.y;\n    } else {\n      item.y = item.y2 - (item.height || 0);\n    }\n  }\n\n  if (encode.yc) {\n    item.y = item.yc - (item.height || 0) / 2;\n  }\n}\n","export default {\n  NaN:        NaN,\n  E:          Math.E,\n  LN2:        Math.LN2,\n  LN10:       Math.LN10,\n  LOG2E:      Math.LOG2E,\n  LOG10E:     Math.LOG10E,\n  PI:         Math.PI,\n  SQRT1_2:    Math.SQRT1_2,\n  SQRT2:      Math.SQRT2,\n  MIN_VALUE:  Number.MIN_VALUE,\n  MAX_VALUE:  Number.MAX_VALUE\n};\n","export default {\n  '*': (a, b) => a * b,\n  '+': (a, b) => a + b,\n  '-': (a, b) => a - b,\n  '/': (a, b) => a / b,\n  '%': (a, b) => a % b,\n  '>': (a, b) => a > b,\n  '<': (a, b) => a < b,\n  '<=': (a, b) => a <= b,\n  '>=': (a, b) => a >= b,\n  '==': (a, b) => a == b,\n  '!=': (a, b) => a != b,\n  '===': (a, b) => a === b,\n  '!==': (a, b) => a !== b,\n  '&': (a, b) => a & b,\n  '|': (a, b) => a | b,\n  '^': (a, b) => a ^ b,\n  '<<': (a, b) => a << b,\n  '>>': (a, b) => a >> b,\n  '>>>': (a, b) => a >>> b\n};\n","export default {\n  '+': a => +a,\n  '-': a => -a,\n  '~': a => ~a,\n  '!': a => !a\n};\n","import { ascending, isString } from 'vega-util';\n\nconst slice = Array.prototype.slice;\n\nconst apply = (m, args, cast) => {\n  const obj = cast ? cast(args[0]) : args[0];\n  return obj[m].apply(obj, slice.call(args, 1));\n};\n\nconst datetime = (yearOrTimestring, m = 0, d = 1, H = 0, M = 0, S = 0, ms = 0) =>\n   isString(yearOrTimestring)\n     ? new Date(yearOrTimestring)\n     : new Date(yearOrTimestring, m, d, H, M, S, ms);\n\nexport default {\n  // math functions\n  isNaN:     Number.isNaN,\n  isFinite:  Number.isFinite,\n  abs:       Math.abs,\n  acos:      Math.acos,\n  asin:      Math.asin,\n  atan:      Math.atan,\n  atan2:     Math.atan2,\n  ceil:      Math.ceil,\n  cos:       Math.cos,\n  exp:       Math.exp,\n  floor:     Math.floor,\n  log:       Math.log,\n  max:       Math.max,\n  min:       Math.min,\n  pow:       Math.pow,\n  random:    Math.random,\n  round:     Math.round,\n  sin:       Math.sin,\n  sqrt:      Math.sqrt,\n  tan:       Math.tan,\n  clamp:     (a, b, c) => Math.max(b, Math.min(c, a)),\n\n  // date functions\n  now:              Date.now,\n  utc:              Date.UTC,\n  datetime:         datetime,\n  date:             d => new Date(d).getDate(),\n  day:              d => new Date(d).getDay(),\n  year:             d => new Date(d).getFullYear(),\n  month:            d => new Date(d).getMonth(),\n  hours:            d => new Date(d).getHours(),\n  minutes:          d => new Date(d).getMinutes(),\n  seconds:          d => new Date(d).getSeconds(),\n  milliseconds:     d => new Date(d).getMilliseconds(),\n  time:             d => new Date(d).getTime(),\n  timezoneoffset:   d => new Date(d).getTimezoneOffset(),\n  utcdate:          d => new Date(d).getUTCDate(),\n  utcday:           d => new Date(d).getUTCDay(),\n  utcyear:          d => new Date(d).getUTCFullYear(),\n  utcmonth:         d => new Date(d).getUTCMonth(),\n  utchours:         d => new Date(d).getUTCHours(),\n  utcminutes:       d => new Date(d).getUTCMinutes(),\n  utcseconds:       d => new Date(d).getUTCSeconds(),\n  utcmilliseconds:  d => new Date(d).getUTCMilliseconds(),\n\n  // sequence functions\n  length:       x => x.length,\n  join:         function() { return apply('join', arguments); },\n  indexof:      function() { return apply('indexOf', arguments); },\n  lastindexof:  function() { return apply('lastIndexOf', arguments); },\n  slice:        function() { return apply('slice', arguments); },\n  reverse:      x => x.slice().reverse(),\n  sort:         x => x.slice().sort(ascending),\n\n  // string functions\n  parseFloat:   parseFloat,\n  parseInt:     parseInt,\n  upper:        x => String(x).toUpperCase(),\n  lower:        x => String(x).toLowerCase(),\n  substring:    function() { return apply('substring', arguments, String); },\n  split:        function() { return apply('split', arguments, String); },\n  replace:      function() { return apply('replace', arguments, String); },\n  trim:         x => String(x).trim(),\n  // Base64 encode/decode\n  // Convert binary string to base64-encoded ascii\n  btoa:         x => btoa(x),\n  // Convert base64-encoded ascii to binary string\n  atob:         x => atob(x),\n\n  // regexp functions\n  regexp:       RegExp,\n  test:         (r, t) => RegExp(r).test(t)\n};\n","import Constants from './constants.js';\nimport Ops from './ops-binary.js';\nimport Unary from './ops-unary.js';\nimport Functions from './functions.js';\n\nconst EventFunctions = ['view', 'item', 'group', 'xy', 'x', 'y'];\nconst DisallowedMethods = new Set([\n  Function,\n  eval,\n  setTimeout,\n  setInterval\n]);\n\nif (typeof setImmediate === 'function') DisallowedMethods.add(setImmediate);\n\nconst Visitors = {\n  Literal: ($, n) => n.value,\n\n  Identifier: ($, n) => {\n    const id = n.name;\n    return $.memberDepth > 0 ? id\n      : id === 'datum' ? $.datum\n      : id === 'event' ? $.event\n      : id === 'item' ? $.item\n      : Constants[id] || $.params['$' + id];\n  },\n\n  MemberExpression: ($, n) => {\n    const d = !n.computed,\n          o = $(n.object);\n    if (d) $.memberDepth += 1;\n    const p = $(n.property);\n    if (d) $.memberDepth -= 1;\n    if (DisallowedMethods.has(o[p])) {\n      // eslint-disable-next-line no-console\n      console.error(`Prevented interpretation of member \"${p}\" which could lead to insecure code execution`);\n      return;\n    }\n    return o[p];\n  },\n\n  CallExpression: ($, n) => {\n    const args = n.arguments;\n    let name = n.callee.name;\n\n    // handle special internal functions used by encoders\n    // re-route to corresponding standard function\n    if (name.startsWith('_')) {\n      name = name.slice(1);\n    }\n\n    // special case \"if\" due to conditional evaluation of branches\n    return name === 'if'\n      ? ($(args[0]) ? $(args[1]) : $(args[2]))\n      : ($.fn[name] || Functions[name]).apply($.fn, args.map($));\n  },\n\n  ArrayExpression: ($, n) => n.elements.map($),\n\n  BinaryExpression: ($, n) => Ops[n.operator]($(n.left), $(n.right)),\n\n  UnaryExpression: ($, n) => Unary[n.operator]($(n.argument)),\n\n  ConditionalExpression: ($, n) => $(n.test)\n    ? $(n.consequent)\n    : $(n.alternate),\n\n  LogicalExpression: ($, n) => n.operator === '&&'\n    ? $(n.left) && $(n.right)\n    : $(n.left) || $(n.right),\n\n  ObjectExpression: ($, n) => n.properties.reduce((o, p) => {\n    $.memberDepth += 1;\n    const k = $(p.key);\n    $.memberDepth -= 1;\n    if (DisallowedMethods.has($(p.value))) {\n      // eslint-disable-next-line no-console\n      console.error(`Prevented interpretation of property \"${k}\" which could lead to insecure code execution`);\n    } else {\n      o[k] = $(p.value);\n    }\n    return o;\n  }, {})\n};\n\nexport default function(ast, fn, params, datum, event, item) {\n  const $ = n => Visitors[n.type]($, n);\n  $.memberDepth = 0;\n  $.fn = Object.create(fn);\n  $.params = params;\n  $.datum = datum;\n  $.event = event;\n  $.item = item;\n\n  // route event functions to annotated vega event context\n  EventFunctions.forEach(f => $.fn[f] = (...args) => event.vega[f](...args));\n\n  return $(ast);\n}\n","import adjustSpatial from './adjust-spatial.js';\nimport interpret from './interpret.js';\n\nexport default {\n  /**\n   * Parse an expression used to update an operator value.\n   */\n  operator(ctx, expr) {\n    const ast = expr.ast, fn = ctx.functions;\n    return _ => interpret(ast, fn, _);\n  },\n\n  /**\n   * Parse an expression provided as an operator parameter value.\n   */\n  parameter(ctx, expr) {\n    const ast = expr.ast, fn = ctx.functions;\n    return (datum, _) => interpret(ast, fn, _, datum);\n  },\n\n  /**\n   * Parse an expression applied to an event stream.\n   */\n  event(ctx, expr) {\n    const ast = expr.ast, fn = ctx.functions;\n    return event => interpret(ast, fn, undefined, undefined, event);\n  },\n\n  /**\n   * Parse an expression used to handle an event-driven operator update.\n   */\n  handler(ctx, expr) {\n    const ast = expr.ast, fn = ctx.functions;\n    return (_, event) => {\n      const datum = event.item && event.item.datum;\n      return interpret(ast, fn, _, datum, event);\n    };\n  },\n\n  /**\n   * Parse an expression that performs visual encoding.\n   */\n  encode(ctx, encode) {\n    const {marktype, channels} = encode,\n          fn = ctx.functions,\n          swap = marktype === 'group'\n              || marktype === 'image'\n              || marktype === 'rect';\n\n    return (item, _) => {\n      const datum = item.datum;\n      let m = 0, v;\n\n      for (const name in channels) {\n        v = interpret(channels[name].ast, fn, _, datum, undefined, item);\n        if (item[name] !== v) {\n          item[name] = v;\n          m = 1;\n        }\n      }\n\n      if (marktype !== 'rule') {\n        adjustSpatial(item, channels, swap);\n      }\n      return m;\n    };\n  }\n};\n"],"names":["item","encode","swap","t","x2","x","width","xc","y2","y","height","yc","NaN","E","Math","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2","MIN_VALUE","Number","MAX_VALUE","*","a","b","+","-","/","%",">","<","<=",">=","==","!=","===","!==","&","|","^","<<",">>",">>>","slice","Array","prototype","apply","m","args","cast","obj","call","datetime","yearOrTimestring","arguments","length","undefined","d","H","M","S","ms","isString","Date","isNaN","isFinite","abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan","clamp","c","now","utc","UTC","date","getDate","day","getDay","year","getFullYear","month","getMonth","hours","getHours","minutes","getMinutes","seconds","getSeconds","milliseconds","getMilliseconds","time","getTime","timezoneoffset","getTimezoneOffset","utcdate","getUTCDate","utcday","getUTCDay","utcyear","getUTCFullYear","utcmonth","getUTCMonth","utchours","getUTCHours","utcminutes","getUTCMinutes","utcseconds","getUTCSeconds","utcmilliseconds","getUTCMilliseconds","join","indexof","lastindexof","reverse","sort","ascending","parseFloat","parseInt","upper","String","toUpperCase","lower","toLowerCase","substring","split","replace","trim","btoa","atob","regexp","RegExp","test","r","EventFunctions","DisallowedMethods","Set","Function","eval","setTimeout","setInterval","setImmediate","add","Visitors","Literal","$","n","value","Identifier","id","name","memberDepth","datum","event","Constants","params","MemberExpression","computed","o","object","p","property","has","console","error","CallExpression","callee","startsWith","fn","Functions","map","ArrayExpression","elements","BinaryExpression","Ops","operator","left","right","UnaryExpression","Unary","argument","ConditionalExpression","consequent","alternate","LogicalExpression","ObjectExpression","properties","reduce","k","key","ast","type","Object","create","forEach","f","vega","ctx","expr","functions","_","interpret","parameter","handler","marktype","channels","v","adjustSpatial"],"mappings":"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"}